<html>
  <head>
    <title>QRCode Reader</title>
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>	
	 <style>
      .text{
        resize: none;
      }
	  div {text-align: center;font-size: 100px;}
    </style>
	<script>var deltat = 0;</script>
  </head>
  <body style="background-color:red;">
  
  	<p></p><p></p><p></p><p></p><p></p>
	<div id="time">CLOSED</div>
	<p></p><p></p><p></p><p></p><p></p>
	
    <center><video id="preview"></video></center><p></p>
	<center><textarea disabled class="text" id='qr'>QRcode info</textarea></center>
    <script>
        let scanner = new Instascan.Scanner(
            {
                video: document.getElementById('preview')
            }
        );
		
		Instascan.Camera.getCameras().then(cameras => 
        {
            if(cameras.length > 0){
                scanner.start(cameras[0]);
            } else {
                console.error("No Camera Found");
            }
        });
		
      scanner.addListener('scan', function(content) {
			document.getElementById('qr').value = content;
			//MANDAR PEDIDO AJAX AQUI
      scan_data = {'qr':content};
      $.ajax({
                url: '/gate_scan',
                type: "GET",
                dataType: "json",
                contentType: 'application/json',
                data: JSON.stringify(scan_data),
                success: function (data) {
                  if (data["open"] == "1") {
                    deltat = 5
                  }
                    
        }})
        
        });
    </script>
	
	<script>
		var x = setInterval(function() {

		  if (deltat <= 0) {
			document.getElementById("time").innerHTML = "CLOSED";
			document.body.style.background = "red";
		  }
		  else{
			document.body.style.background = "green";
			document.getElementById("time").innerHTML = "OPEN for " + deltat + " seconds";
			deltat-=1;
		  }
		  
		}, 1000);
	</script>
 </body>
</html>